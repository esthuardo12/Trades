<!Doctype HTML>
<html lang="en">
    <HEAD>
      <meta charset="utf-8">
      <title>Registro con usuario existente</title>

      <!-- Icons font CSS-->
      <link href="vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">
      <link href="vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
      <!-- Font special for pages-->
      <link href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
      <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <!-- Main CSS-->
      <link href="registro.css" rel="stylesheet" media="all">
    </HEAD>
    <BODY style="background-color:#F4FDFE;">
      <div class="page-wrapper bg-gra-03 p-t-130 p-b-100 font-poppins">
        <div class="wrapper wrapper--w680">
            <div class="card card-4">
                <div class="card-body">
                    <center><h2 class="title">Registro a Trades</h2></center>
                    <form onsubmit="return registrar()" method="post">
                        <div class="row row-space">
                            <div class="col-2">
                                <div class="input-group">
                                    <label class="label">Nombre</label>
                                    <input id="inputNombre" class="input--style-4" type="text" name="first_name"required>
                                </div>
                            </div>
                            <div class="col-2">
                                <div class="input-group">
                                    <label class="label">Apellido</label>
                                    <input id="inputApellido" class="input--style-4" type="text" name="last_name"required>
                                </div>
                            </div>
                        </div>
                        <div class="row row-space">
                            <div class="col-2">
                                <div class="input-group">
                                    <label class="label">Número de teléfono</label>
                                    <input id="inputTelefono" class="input--style-4" type="text" name="phone"required>
                                </div>
                            </div>
                        </div>
                        <div class="row row-space">
                          <div class="col-2">
                              <div class="input-group">
                                  <label class="label">Dirección</label>
                                  <input id="inputDireccion" class="input--style-4" type="text" name="direccion"required>
                              </div>
                          </div>
                          <div class="col-2">
                            <div class="input-group">
                                <label class="label">DPI</label>
                                <input id="inputDPI" class="input--style-4" type="text" name="DPI"pattern="\d{13}$" 
                                title="Ingresar formato correcto de DPI"required>
                            </div>
                        </div>
                      </div>
                        <div class="p-t-15">
                            <button class="btn btn--radius-2 btn--blue" type="submit" >Registrar</button>
                        </div>
                    </form>
                    <p id="respa"></p>
                </div>
            </div>
        </div>
    </div>
        <script>
          let Url="http://localhost:3000/"
          function registrar(){
            let nombre=document.getElementById("inputNombre").value;
            let apellido=document.getElementById("inputApellido").value;
            let telefono=document.getElementById("inputTelefono").value;
            let direccion=document.getElementById("inputDireccion").value;
            let dpi=document.getElementById("inputDPI").value;
            $.ajax({
                url:Url + "registrarConId",
                type: "POST",
                data: {"user": sessionStorage['correoNuevo'],"id":sessionStorage['idnuevo'],"nombre":nombre,"apellido":apellido,"telefono":telefono,"direccion":direccion,"dpi":dpi},
                success: function(result){
                    alert('Usuario registrado con éxito')
                    console.log(result)
                    window.location.replace("login.html")
                },
                error: function(error){
                    if(error.responseText=="\"Firebase: Error (auth/email-already-in-use).\""){
                        alert("Su correo ya se encuentra registrado!")
                    }else{
                        alert('Error al registrar el usuario!')
                    }
                    console.log(error)
                    
                } 
            });
            //$("#respa").html("");
            //alert("TERMINO REGISTRO");
            return false;
            }
            
          
          if(sessionStorage['idnuevo']==null || sessionStorage['idnuevo']==""){
                //console.log("No tiene variable de sesion");
              window.location.replace("login.html")
            } 
        </script>
    </BODY>
</HTML>

<!-- Nombre, telefono, direccion, horario, categoria, fotos-->